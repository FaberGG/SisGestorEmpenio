<UserControl x:Class="SisGestorEmpenio.vistas.ConsultarPrestamosView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Height="500" Width="850"
             Background="#F5F7FA">

    <UserControl.Resources>
        <!-- Estilos para los controles -->
        <Style x:Key="ComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Height" Value="38"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="8,5"/>
        </Style>

        <Style x:Key="SearchBoxStyle" TargetType="TextBox">
            <Setter Property="Height" Value="38"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="5"/>
        </Style>

        <Style x:Key="ControlBorderStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
        </Style>

        <!-- Plantilla para el botón de tres puntos -->
        <Style x:Key="EllipsisButtonStyle" TargetType="Button">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="Transparent" Padding="8,0">
                            <TextBlock Text="&#8942;" FontSize="20" FontWeight="Bold"
                                       VerticalAlignment="Center" HorizontalAlignment="Center"
                                       Foreground="#505A64"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <!-- Estilos para los botones de paginación -->
        <Style x:Key="PaginationButtonStyle" TargetType="Button">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="White" 
                                BorderBrush="#E0E0E0" 
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="8,6"
                                Margin="2,0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#F5F7FA"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#3498DB"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#E8F4FD"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#F8F9FA"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#E9ECEF"/>
                                <Setter Property="Foreground" Value="#6C757D"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="MinWidth" Value="32"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#495057"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <Style x:Key="PaginationButtonActiveStyle" TargetType="Button" BasedOn="{StaticResource PaginationButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="#3498DB" 
                                BorderBrush="#3498DB" 
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="8,6"
                                Margin="2,0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <Style x:Key="NavigationButtonStyle" TargetType="Button" BasedOn="{StaticResource PaginationButtonStyle}">
            <Setter Property="MinWidth" Value="80"/>
            <Setter Property="Padding" Value="12,6"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Panel de título -->
        <Border Grid.Row="0" Background="White" BorderThickness="0,0,0,1" BorderBrush="#E0E0E0" Padding="20,15">
            <TextBlock Text="Consulta de Préstamos" FontSize="20" FontWeight="Medium" Foreground="#333333"/>
        </Border>

        <!-- Contenido -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- FILTROS -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                <!-- Estado -->
                <Border Style="{StaticResource ControlBorderStyle}" Margin="0,0,10,0">
                    <ComboBox x:Name="cmbEstado"
                              Width="120"
                              Style="{StaticResource ComboBoxStyle}"
                              SelectedIndex="0"
                              SelectionChanged="Filtro_SelectionChanged">
                        <ComboBoxItem Content="Estado" IsEnabled="False"/>
                        <ComboBoxItem Content="Activo"/>
                        <ComboBoxItem Content="Inactivo"/>
                        <ComboBoxItem Content="Todos"/>
                    </ComboBox>
                </Border>

                <!-- Rango de tiempo -->
                <Border Style="{StaticResource ControlBorderStyle}" Margin="0,0,10,0">
                    <ComboBox x:Name="cmbRangoTiempo"
                              Width="150"
                              Style="{StaticResource ComboBoxStyle}"
                              SelectedIndex="0"
                              SelectionChanged="Filtro_SelectionChanged">
                        <ComboBoxItem Content="Rango de tiempo" IsEnabled="False"/>
                        <ComboBoxItem Content="Hoy"/>
                        <ComboBoxItem Content="Últimos 5 días"/>
                        <ComboBoxItem Content="Últimos 8 días"/>
                        <ComboBoxItem Content="Últimos 15 días"/>
                        <ComboBoxItem Content="Últimos 30 días"/>
                        <ComboBoxItem Content="Todo el tiempo"/>
                    </ComboBox>
                </Border>

                <!-- Identificación -->
                <Border Style="{StaticResource ControlBorderStyle}">
                    <TextBox x:Name="txtIdentificacion"
                             Width="220"
                             Style="{StaticResource SearchBoxStyle}"
                             Text="Identificación..."
                             Foreground="Gray"
                             Padding="12,0,5,0"
                             GotFocus="TxtIdentificacion_GotFocus"
                             LostFocus="TxtIdentificacion_LostFocus"
                             TextChanged="TxtIdentificacion_TextChanged"/>
                </Border>
            </StackPanel>

            <!-- DATA GRID -->
            <Border Grid.Row="1" Background="White" CornerRadius="8" BorderThickness="1" BorderBrush="#E0E0E0">
                <DataGrid x:Name="dgPrestamos"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          IsReadOnly="True"
                          HeadersVisibility="Column"
                          RowBackground="White"
                          AlternatingRowBackground="#F9FAFC"
                          GridLinesVisibility="None"
                          BorderThickness="0"
                          ColumnHeaderHeight="40"
                          RowHeight="50"
                          SelectionMode="Single"
                          SelectionUnit="FullRow">

                    <DataGrid.Resources>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="White"/>
                            <Setter Property="Foreground" Value="#505A64"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="Padding" Value="12,0"/>
                            <Setter Property="BorderThickness" Value="0,0,0,1"/>
                            <Setter Property="BorderBrush" Value="#EEEEEE"/>
                            <Setter Property="Height" Value="50"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                        </Style>
                        <Style TargetType="DataGridCell">
                            <Setter Property="Padding" Value="12,0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="DataGridCell">
                                        <Border Padding="{TemplateBinding Padding}"
                                                BorderThickness="0"
                                                Background="{TemplateBinding Background}">
                                            <ContentPresenter VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGrid.Resources>

                    <DataGrid.Columns>
                        <!-- ID Cliente -->
                        <DataGridTextColumn Header="Identificación"
                                            Binding="{Binding ClienteId}"
                                            Width="*"/>
                        <!-- Nombre Cliente -->
                        <DataGridTextColumn Header="Nombre Cliente"
                                            Binding="{Binding ClienteNombre}"
                                            Width="1.5*"/>
                        <!-- Artículo -->
                        <DataGridTextColumn Header="Artículo"
                                            Binding="{Binding ArticuloNombre}"
                                            Width="1.5*"/>
                        <!-- Fecha Inicio -->
                        <DataGridTextColumn Header="Fecha Inicio"
                                            Binding="{Binding FechaInicio}"
                                            Width="*"/>
                        <!-- Fecha Fin -->
                        <DataGridTextColumn Header="Fecha Fin"
                                            Binding="{Binding FechaFin}"
                                            Width="*"/>

                        <!-- Estado con template -->
                        <DataGridTemplateColumn Header="Estado" Width="*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border CornerRadius="4" Padding="8,4" HorizontalAlignment="Left">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#EEEEEE"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Estado}" Value="activo">
                                                        <Setter Property="Background" Value="#E8F5E9"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Estado}" Value="inactivo">
                                                        <Setter Property="Background" Value="#FFEBEE"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock Text="{Binding Estado}">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="#333333"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Estado}" Value="activo">
                                                            <Setter Property="Foreground" Value="#2E7D32"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Estado}" Value="inactivo">
                                                            <Setter Property="Foreground" Value="#C62828"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Botón de acciones -->
                        <DataGridTemplateColumn Header="" Width="60">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Style="{StaticResource EllipsisButtonStyle}"
                                            Tag="{Binding IdPrestamo}"
                                            Click="BtnVerDetalles_Click">
                                        <Button.ContextMenu>
                                            <ContextMenu>
                                                <MenuItem Header="Ver Detalles"
                                                          Click="MenuVerDetallesDevolucion_Click"
                                                          Tag="{Binding IdPrestamo}"/>
                                            </ContextMenu>
                                        </Button.ContextMenu>
                                    </Button>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>
        </Grid>

        <!-- BARRA DE PAGINACIÓN -->
        <Border Grid.Row="2" Background="White" BorderThickness="0,1,0,0" BorderBrush="#E0E0E0" Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Información de registros -->
                <TextBlock x:Name="txtInfoRegistros" 
                           Grid.Column="0"
                           Text="Mostrando 1-10 de 100 registros"
                           VerticalAlignment="Center"
                           Foreground="#6C757D"
                           FontSize="14"/>

                <!-- Controles de navegación -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <!-- Botón Anterior -->
                    <Button x:Name="btnAnterior"
                            Content="Anterior"
                            Style="{StaticResource NavigationButtonStyle}"
                            Click="BtnAnterior_Click"
                            Margin="0,0,10,0"/>

                    <!-- Panel de números de página -->
                    <StackPanel x:Name="pnlPaginas" 
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="0,0,10,0"/>

                    <!-- Botón Siguiente -->
                    <Button x:Name="btnSiguiente"
                            Content="Siguiente"
                            Style="{StaticResource NavigationButtonStyle}"
                            Click="BtnSiguiente_Click"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>